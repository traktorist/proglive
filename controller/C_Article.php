<?php//// Конттроллер страницы чтения.//class C_Article extends C_Base {    private $mArticles;	//	// Конструктор потрачен.	//    public function __construct() {        parent::__construct();        $this->mArticles = M_Articles::Instance();    }    public function action_index() {        // если только что была добавлена статья        if ($_SESSION['add_success']) {            unset($_SESSION['add_success']);            $add_success = true;        }        // Извлечение статей.        $mArticles = M_Articles::Instance();        if (!$articles = $this->mArticles->articles_all()) die('что-то пошло не так!');        // Вывод в шаблон.        $this->center_page = $this->Template('/view/V_Index.php', array('articles' => $articles,                                                                        'add_success' => $add_success));    }    public function action_editor() {        // если только что была добавлена статья        if ($_SESSION['update_success']) {            unset($_SESSION['update_success']);            $update_success = true;        }        // если только что была удалена статья        if ($_SESSION['delete_success']) {            unset($_SESSION['delete_success']);            $delete_success = true;        }        // Извлечение статей.        if (!$articles = $this->mArticles->articles_all()) die('что-то пошло не так!');        // Вывод в шаблон.        $this->center_page = $this->Template('/view/V_Editor.php', array(   'articles' => $articles,                                                                            'update_success' => $update_success,                                                                            'delete_success' => $delete_success));    }    public function action_article() {        // Извлечение статьи если есть её id        if (!isset($_GET['id_article'])) die('Не указан id статьи!');        elseif(!$article = $this->mArticles->get_article($_GET['id_article'])) die('что-то пошло не так!');        // Вывод в шаблон.        $right_page = $this->Template('/view/V_Right.php');        $this->center_page = $this->Template('/view/V_Article.php', array(  'article' => $article,                                                                            'right_page' => $right_page));    }    public function action_edit() {        // Обработка отправки формы.        if ($this->IsPost()) {            if (($_POST['subject'] == '' || $_POST['content'] == '') && !isset($_POST['cancel'])) {           // не заполнено одно из полей и нажали не Отмена                $id_article = $_POST['id_article'];                $subject = $_POST['subject'];                $content = $_POST['content'];                $empty_field = true;            }            else {                                                              // тема и текст статьи не пусты, переданы POST'ом - нужно что-то сделать с ней                if (isset($_POST['save'])) {                    if (!$this->mArticles->edit_article($_POST['id_article'], $_POST['subject'], $_POST['content'])) die('Не удалось изменить запись в БД!');                }                if (isset($_POST['delete'])) {                    if (!$this->mArticles->delete_article($_POST['id_article'])) die('Не удалось удалить запись из БД!');                }                header('Location: /index.php?c=article&act=editor');                                 // статья добавлена или нажали кнопку Отмена                die();            }        }        else {            // Извлечение статьи если есть её id            if (!isset($_GET['id_article'])) die('Не указан id статьи!');            elseif(!$article = $this->mArticles->get_article($_GET['id_article'])) die('что-то пошло не так!');            $id_article = $article['id_article'];            $subject = $article['subject'];            $content = $article['content'];            $empty_field = false;        }        // Вывод в шаблон.        $this->center_page = $this->Template('/view/V_Edit.php', array( 'id_article' => $id_article,                                                                        'subject' => $subject,                                                                        'content' => $content,                                                                        'empty_field' => $empty_field));    }    public function action_new() {        // Обработка отправки формы.        if (!empty($_POST)) {            if ($_POST['subject'] == '' || $_POST['content'] == '') {                                   // не заполнено одно из полей                $subject = $_POST['subject'];                $content = $_POST['content'];                $empty_field = true;            }            elseif (!$this->mArticles->new_article($_POST['subject'], $_POST['content'])) die('что-то пошло не так!');    // не удалось записать в БД            else {                                                                                      // статья добавлена                header('Location: /index.php?c=article&act=index');                die();            }        }        else {            $subject = '';            $content = '';            $empty_field = false;        }        // Вывод в шаблон.        $this->center_page = $this->Template('/view/V_New.php', array(  'subject' => $subject,                                                                        'content' => $content,                                                                        'empty_field' => $empty_field));    }}?>