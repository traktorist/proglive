<?php//// Конттроллер страницы чтения.//class C_Comment extends C_Base {    private $mComments;	//	// Конструктор	//    public function __construct() {        parent::__construct();        $this->mComments = M_Comments::Instance();    }    public function action_index($id_article) {        // Извлечение комментов для конкретной статьи.        if (!$comments = $this->mComments->comments_all($id_article)) return array(array('text' => 'комментариев нет'));        return $comments;    }    public function action_new() {        // Обработка отправки формы.        if (!empty($_POST)) {            if ($_POST['text'] == '') {                                                                 // не заполнено поле коммента                $text = $_POST['text'];                $empty_field = true;            }            elseif (!$this->mComments->new_comment($_POST['text'], $_POST['id_article'])) die('что-то пошло не так!');        // не удалось записать в БД            else {                                                                                      // коммент добавлен                header('Location: /index.php?c=article&act=article&id_article=' . $_POST['id_article']);                die();            }        }        else {            $text = '';            $empty_field = false;        }    }    public function action_edit() {        // Обработка отправки формы.        if ($this->IsPost()) {            if (($_POST['subject'] == '' || $_POST['content'] == '') && !isset($_POST['cancel'])) {           // не заполнено одно из полей и нажали не Отмена                $id_article = $_POST['id_article'];                $subject = $_POST['subject'];                $content = $_POST['content'];                $empty_field = true;            }            else {                                                              // тема и текст статьи не пусты, переданы POST'ом - нужно что-то сделать с ней                if (isset($_POST['save'])) {                    if (!$this->mArticles->edit_article($_POST['id_article'], $_POST['subject'], $_POST['content'])) die('Не удалось изменить запись в БД!');                }                if (isset($_POST['delete'])) {                    if (!$this->mArticles->delete_article($_POST['id_article'])) die('Не удалось удалить запись из БД!');                }                header('Location: /index.php?c=article&act=editor');                                 // статья добавлена или нажали кнопку Отмена                die();            }        }        else {            // Извлечение статьи если есть её id            if (!isset($_GET['id_article'])) die('Не указан id статьи!');            elseif(!$article = $this->mArticles->get_article($_GET['id_article'])) die('что-то пошло не так!');            $id_article = $article['id_article'];            $subject = $article['subject'];            $content = $article['content'];            $empty_field = false;        }        // Вывод в шаблон.        $this->center_page = $this->Template('/view/V_Edit.php', array( 'id_article' => $id_article,                                                                        'subject' => $subject,                                                                        'content' => $content,                                                                        'empty_field' => $empty_field));    }}?>